<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>CiCi小姐姐</title>
  <meta name="viewport" content="width=device-width,user-scalable=no,minimum-scale=1,maximum-scale=1">
  <link rel="stylesheet" href="css/animate.min.css">

  <!-- ========= 计时器 + 放大预览 样式 ========= -->
  <style>
    /* 计时器 */
    #timer{
      position:fixed;
      top:20px;
      right:20px;
      background:rgba(0,0,0,.55);
      border:1px solid rgba(0,255,255,.6);
      box-shadow:0 0 10px rgba(0,255,255,.8);
      border-radius:8px;
      padding:8px 16px;
      font-family:'Courier New',monospace;
      font-size:18px;
      color:#00ffff;
      letter-spacing:1px;
      z-index:999;
    }
    #since2025{ text-shadow:0 0 4px #0ff,0 0 8px #0ff; }

    /* 右侧放大预览 */
    #hoverPreview{
      position:fixed;
      right:-280px;
      top:50%;
      transform:translateY(-50%);
      width:240px;
      background:rgba(0,0,0,.75);
      border:1px solid rgba(0,255,255,.6);
      border-radius:8px;
      padding:12px;
      color:#fff;
      font-size:14px;
      text-align:center;
      box-shadow:0 0 15px rgba(0,255,255,.6);
      transition:right .35s ease;
      z-index:1000;
    }
    #hoverPreview img{
      width:100%;
      border-radius:6px;
      margin-bottom:8px;
    }
    #hoverPreview.show{ right:20px; }

    /* 原有样式保持不变 */
    html,body{height:100%;}
    body{background:#000;margin:0;font-family:Helvetica,sans-serif;overflow:hidden;}
    #menu{position:absolute;bottom:20px;width:100%;text-align:center;}
    button{color:rgba(127,255,255,.75);background:transparent;border:1px solid rgba(127,255,255,.75);padding:5px 10px;margin:0 4px;cursor:pointer;transition:.3s;}
    button:hover{background:rgba(0,255,255,.5);}
    .element{width:100px;height:100px;box-shadow:0 0 12px rgba(0,255,255,.5);border:1px solid rgba(127,255,255,.25);text-align:center;cursor:pointer;}
    .element:hover{box-shadow:0 0 12px rgba(0,255,255,.75);border-color:rgba(127,255,255,.75);}
    .element img{width:100px;height:100px;}
    .show_info{position:fixed;top:30%;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.6);padding:10px;border-radius:5px;box-shadow:0 0 10px #fff;width:300px;text-align:center;display:none;}
    .show_info img{width:200px;border-radius:5px;}
    .intro{color:#fff;text-indent:20px;margin-top:10px;}
  </style>
</head>

<body>
  <!-- ===== 3D 容器 ===== -->
  <div id="container"></div>

  <!-- ===== 音乐 ===== -->
  <audio autoplay loop>
    <source src="http://www.ytmp3.cn/down/72794.mp3">
  </audio>

  <!-- ===== 底部按钮 ===== -->
  <div id="menu">
    <button id="table">表格</button>
    <button id="sphere">球球</button>
    <button id="helix">螺旋</button>
    <button id="grid">格子</button>
  </div>

  <!-- ===== 计时器 ===== -->
  <div id="timer">
    <span id="since2025">相识加载中…</span>
  </div>

  <!-- ===== 右侧放大预览 ===== -->
  <div id="hoverPreview">
    <img id="previewImg" src="" alt="">
    <div id="previewTxt">介绍加载中…</div>
  </div>

  <!-- ===== 中间弹窗（原 show_info，保留）===== -->
  <div class="show_info animated" style="display:none;">
    <div class="info_my">
      <img width="200" src="img/c.png">
    </div>
    <div class="intro">天气好冷，我的心是冰冰的！</div>
  </div>

  <!-- ===== JS 库 ===== -->
  <script src="js/jquery.min.js"></script>
  <script src="js/three.js"></script>
  <script src="js/tween.min.js"></script>
  <script src="js/TrackballControls.js"></script>
  <script src="js/CSS3DRenderer.js"></script>

  <!-- ===== 页面脚本 ===== -->
  <script>
    /* ---------- 3D 照片墙 ---------- */
    var personArray = [];
    for (var i = 0; i < 199; i++) personArray.push({ image: "img/a.png" });

    var table = [];
    for (var i = 0; i < personArray.length; i++) {
      table[i] = {
        image: personArray[i].image,
        p_x: i % 20 + 1,
        p_y: Math.floor(i / 20) + 1
      };
    }

    var camera, scene, renderer, controls;
    var objects = [];
    var targets = { table: [], sphere: [], helix: [], grid: [] };

    init(); animate();

    function init() {
      camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 1, 10000);
      camera.position.z = 3000;
      scene = new THREE.Scene();

      // 生成元素
      for (var i = 0; i < table.length; i++) {
        var element = document.createElement('div');
        element.className = 'element';
        element.style.backgroundColor = 'rgba(0,127,127,' + (Math.random() * .5 + .25) + ')';
        var img = document.createElement('img');
        img.src = table[i].image;
        element.appendChild(img);
        var object = new THREE.CSS3DObject(element);
        object.position.set(Math.random() * 4000 - 2000, Math.random() * 4000 - 2000, Math.random() * 4000 - 2000);
        scene.add(object); objects.push(object);

        var t = new THREE.Object3D();
        t.position.x = (table[i].p_x * 140) - 1330;
        t.position.y = -(table[i].p_y * 180) + 990;
        targets.table.push(t);
      }

      // sphere / helix / grid 布局
      var vec = new THREE.Vector3();
      var sph = new THREE.Spherical();
      for (var i = 0, l = objects.length; i < l; i++) {
        var phi = Math.acos(-1 + (2 * i) / l);
        var theta = Math.sqrt(l * Math.PI) * phi;
        sph.set(800, phi, theta);
        var obj = new THREE.Object3D(); obj.position.setFromSpherical(sph);
        vec.copy(obj.position).multiplyScalar(2); obj.lookAt(vec);
        targets.sphere.push(obj);
      }

      var cyl = new THREE.Cylindrical();
      for (var i = 0, l = objects.length; i < l; i++) {
        var th = i * 0.175 + Math.PI;
        var y = -(i * 5) + 450;
        cyl.set(900, th, y);
        var obj = new THREE.Object3D(); obj.position.setFromCylindrical(cyl);
        vec.set(obj.position.x * 2, obj.position.y, obj.position.z * 2); obj.lookAt(vec);
        targets.helix.push(obj);
      }

      for (var i = 0; i < objects.length; i++) {
        var obj = new THREE.Object3D();
        obj.position.x = ((i % 5) * 400) - 800;
        obj.position.y = (-(Math.floor(i / 5) % 5) * 300) + 500;
        obj.position.z = (Math.floor(i / 25)) * 200 - 800;
        targets.grid.push(obj);
      }

      renderer = new THREE.CSS3DRenderer();
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.getElementById('container').appendChild(renderer.domElement);

      controls = new THREE.TrackballControls(camera, renderer.domElement);
      controls.rotateSpeed = 0.5; controls.minDistance = 500; controls.maxDistance = 6000;
      controls.addEventListener('change', render);

      ['table','sphere','helix','grid'].forEach(id=>{
        document.getElementById(id).addEventListener('click',()=>transform(targets[id],1000));
      });
      transform(targets.table,2000);

      window.addEventListener('resize', onWindowResize, false);
    }

    function transform(targets, duration) {
      TWEEN.removeAll();
      for (var i = 0; i < objects.length; i++) {
        var object = objects[i], target = targets[i];
        new TWEEN.Tween(object.position)
          .to({ x: target.position.x, y: target.position.y, z: target.position.z }, Math.random() * duration + duration)
          .easing(TWEEN.Easing.Exponential.InOut).start();
        new TWEEN.Tween(object.rotation)
          .to({ x: target.rotation.x, y: target.rotation.y, z: target.rotation.z }, Math.random() * duration + duration)
          .easing(TWEEN.Easing.Exponential.InOut).start();
      }
      new TWEEN.Tween(this).to({}, duration * 2).onUpdate(render).start();
    }

    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
      render();
    }

    function animate() {
      requestAnimationFrame(animate);
      scene.rotation.y += 0.008;
      TWEEN.update(); controls.update(); render();
    }

    function render() { renderer.render(scene, camera); }

    /* ---------- 计时器 ---------- */
    function updateSince2025(){
      const start = new Date('2025-02-10T11:54:00');
      const now   = new Date();
      const diff  = now - start;
      const total = Math.floor(diff/1000);
      const sec   = total % 60;
      const min   = Math.floor(total/60)%60;
      const hour  = Math.floor(total/3600)%24;
      const day   = Math.floor(total/86400);
      const pad   = n => n.toString().padStart(2,'0');
      document.getElementById('since2025').textContent =
        `相识 ${day} 天 ${pad(hour)}:${pad(min)}:${pad(sec)}`;
    }
    updateSince2025(); setInterval(updateSince2025,1000);

    /* ---------- 右侧放大预览 ---------- */
    const hoverBox = document.getElementById('hoverPreview');
    const hoverImg = document.getElementById('previewImg');
    const hoverTxt = document.getElementById('previewTxt');

    document.addEventListener('mouseover', e=>{
      const el = e.target.closest('.element');
      if(!el) return;
      const img = el.querySelector('img');
      hoverImg.src = img.src;
      hoverTxt.textContent = 'CiCi 的萌照，今天是认识你的第 ' +
        Math.floor((Date.now()-new Date('2025-02-10T11:54:00'))/86400000) + ' 天！';
      hoverBox.classList.add('show');
    });

    document.addEventListener('mouseout', e=>{
      if(e.target.closest('.element')) hoverBox.classList.remove('show');
    });
  </script>
</body>
</html>